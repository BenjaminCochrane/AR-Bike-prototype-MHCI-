<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY&callback=myMap"></script>
    <script>
      // Global variables: store food order data
      var food_prices = [3.50, 1.50, 1.00];
      var order_total = 0.0;
      var order_count = 0;
      
      // Update the order value label to current total
      function updateOrderValueLabel() {
        document.querySelector("#order-price").setAttribute("value", order_total.toFixed(2));
      }
      
      // Clear all items from the order
      function clearOrder() {
        order_total = 0.0;
        order_count = 0;
        updateOrderValueLabel();
        
        document.querySelector("#basket").replaceChildren();
      }
      
      // Overlay componenet for HUD so that the hud 
      // objects won't clip through test objects
      AFRAME.registerComponent("overlay", {
        dependencies: ['material'],
        init: function () {
          this.el.sceneEl.renderer.sortObjects = true;
          this.el.object3D.renderOrder = 100;
          this.el.components.material.material.depthTest = false;
        }
      });
      
      /*
       * Component for the 'clear order' button.
       */
      AFRAME.registerComponent("clear-button", {
        // Init gets called just once, when initialised
        init: function () {
          var element = this.el;
          
          // Cursor enter
          element.addEventListener("mouseenter", function () {
            
          });

          // Cursor leave
          element.addEventListener("mouseleave", function () {
            
          });

          // Cursor click: empty order basket
          element.addEventListener("click", function () {
            clearOrder();
          });
        },
        
        /*
         * Tick gets called every frame update. We want to create the effect of the clear
         * button fading-in to become visible only as the user 'looks down' towards it.
         */
        tick: function () {
          var element = this.el;
          
          // We need the camera to determine where the user is looking
          var camera = this.el.sceneEl.camera.el;
          var rotation = camera.getAttribute("rotation");
          
          // Calculate opacity based on downward tilt (rotation around x-axis), with a maximum of 50%
          var opacity = 50;
          
          // Set background opacity - note opacity needs to be converted from % to [0.0, 1.0]
          element.querySelector("#clear-button-bg").setAttribute("opacity", opacity * 0.01);
          
          // Set text opacity - use different scale so it"s brighter, for better readability
          element.querySelector("#clear-button-fg").setAttribute("opacity", opacity * 0.02);
        }
      });
      
      //google maps api conversion to aframe -in progress
      AFRAME.registerComponent('googleMap', {
        schema: {object_id:""},
        
        init: function(){
          var mapProp= {
          center:new google.maps.LatLng(51.508742,-0.120850),
          zoom:5,
          };
          var map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
        }
        
      })
      // still in progress
      
      /*
       * Component for food menu item buttons.
       */
      AFRAME.registerComponent("menu-button", {
        schema: {
          item_id: { default: "0" },
          started: { default: false },
        },

        init: function () {
          var data = this.data;
          var element = this.el;

          // Cursor enter: start or resume rotation animation, depending on prior animation state
          element.addEventListener("mouseenter", function () {
            
          });

          // Cursor leave: pause rotation animation
          element.addEventListener("mouseleave", function () {
            
          });

          // Cursor click: start the scale animation
          element.addEventListener("click", function () {
            element.querySelector(".icon").emit("event-name");
          });
        },
      });
    </script>
  </head>
  <body>
    <a-scene render-order="HUD, test-objects, floor">
      <!-- Assets: 3D models and mixin definitions -->
      <a-assets>
        <a-asset-item id="model-burger" src="https://cdn.glitch.global/326e3dc1-eeff-4f02-8913-b8b16b58dbfd/burger.gltf?v=1673470710342"></a-asset-item>
        <a-assest-item id="map" src="https://cdn.glitch.global/c1150980-99ea-45c3-aac3-4ac3325f3b9e/map.jpg?v=1675688231794"></a-assest-item>
        
        <!-- Target sphere surrounding each menu item -->
        <a-mixin id="item-sphere" button geometry="primitive: sphere;" material="color: white; opacity: 0.3;" scale="0.15 0.15 0.15"></a-mixin>
        
        <!-- 3D model icon for menu items -->
        <a-mixin id="item-icon" scale="5 5 5"
                 animation__hover="property: rotation; to: 0 360 0; dur: 4000; easing: linear; loop: true; startEvents: rotation-begin; pauseEvents: rotation-pause; resumeEvents: rotation-resume;"
                 animation__click="property: scale; from: 3 3 3; to: 5 5 5; dur: 500; easing: linear; loop: false; startEvents: scale-begin;"></a-mixin>
        
        <!-- Text label for menu items -->
        <a-mixin id="item-label" geometry="primitive: plane;" material="opacity: 0.0;" scale="1.5 1.5 1.5" text="align: center; anchor: center; baseline: center; color: white; wrap-count: 10;"></a-mixin>
        <a-mixin id="menu-item" geometry="width: 2; height: 2;" material="color: #003865" text="align: center; anchor: center; baseline: center; color: white; wrap-count: 15;"></a-mixin>
        
      </a-assets>

      <!-- Sky fills the background with a solid colour -->
      <a-sky color="#518CC9"></a-sky>
      <a-plane id="floor" position ="0 0 -4" rotation ="-90 0 0" width="40" height="40" color="#7BC8A4"></a-plane>

      <!-- lovely colour, cheers, Is that supposed to be the ground???? yes lol-->
      
      <!-- Create cursor with animated visual feedback -->
      <a-entity camera look-controls wasd-controls position="0 1.6 0">
        <a-entity cursor="fuse: true; fuseTimeout: 800" raycaster="objects: .selectable"
                  material="color: white; shader: flat; opacity: 0.8;" position="0 0 -0.1"
                  geometry="primitive: ring; radiusInner: 0.002; radiusOuter: 0.004"
                  animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 500; from: 0.2 0.2 0.2; to: 1 1 1"
                  animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 800; from: 1 1 1; to: 0.2 0.2 0.2"
                  animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 100; to: 1 1 1">
        </a-entity>
      </a-entity>
      
      Main HUD display
      <a-entity id="HUD" camera look-controls wasd-controls position="0 1.6 0">
        <a-image id="hudMap" src="https://cdn.glitch.global/c1150980-99ea-45c3-aac3-4ac3325f3b9e/map.jpg?v=1675688231794"
                 overlay rotation="0 0 0" position="-1.1 1.15 -2" width="1" height="1" material="opacity: 0.8"></a-image>
        <a-image id="hudMusic" src="https://cdn.glitch.global/c1150980-99ea-45c3-aac3-4ac3325f3b9e/spotify.jpg?v=1675688231794"
                 overlay rotation="0 0 0" position="-1 -1.35 -2" width="1.2" height="0.6" material="opacity: 0.8"></a-image>
      </a-entity>
      
<!--       Objects for hand tracking in aframe -->
      <a-entity id="leftHand" hand-tracking-controls="hand: left;"></a-entity>
      <a-entity id="rightHand" hand-tracking-controls="hand: right;"></a-entity>
      
<!--       google maps api still in progress -->
      <a-entity>
        <div id="googleMap" style="width:100%;height:400px;"></div>


      </a-entity>
<!--       Still in progress -->
      
      
      
      <a-entity id="test-objects" position="0 1.6 -1">
        <a-circle menu-button="item_id: 1;" mixin="item-sphere" class="selectable" position="-0.6 0.6 0" rotation="0 0 0">
          <a-entity mixin="item-icon" class="icon" gltf-model="#map" position="0 0.2 0" scale="5 5 5"></a-entity>
        </a-circle>
      </a-entity>
    </a-scene>
  </body>
</html>
