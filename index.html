<!DOCTYPE html>
<html>
  <head>
    <script src="shake.js"></script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script>
      var food_prices = [3.50, 1.50, 1.00];
      var order_total = 0.0;
      var order_count = 0;
      
      function updateOrderValueLabel() {
        document.querySelector('#order-price').setAttribute('value', order_total.toFixed(2));
      }
      
      var shakeEvent = new Shake({threshold: 15, timeout: 1000});
      window.addEventListener('shake', shakeEventDetected, false);

      function shakeEventDetected () {
        // Clear the basket
        document.querySelector('#basket').replaceChildren();
        
        order_total = 0.0;
        order_count = 0;
        
        updateOrderValueLabel();
      }
      
      shakeEvent.start();
      
      AFRAME.registerComponent("button", {
        schema: {
          item_id: { default: "0" },
          started: { default: false },
        },

        init: function () {
          var data = this.data;
          var element = this.el;

          // Cursor enter: start or resume rotation animation, depending on prior animation state
          element.addEventListener("mouseenter", function () {
            targeted = true;

            if (data.started) {
              element.querySelector(".icon").emit("rotation-resume");
            } else {
              data.started = true;
              element.querySelector(".icon").emit("rotation-begin");
            }
          });

          // Cursor leave: pause rotation animation
          element.addEventListener("mouseleave", function () {
            element.querySelector(".icon").emit("rotation-pause");
          });

          // Cursor click: start the scale animation
          element.addEventListener("click", function () {
            element.querySelector(".icon").emit("scale-begin");
            
            <!-- Update order price -->
            order_total += food_prices[data.item_id - 1];
            updateOrderValueLabel();
            
            <!-- Calculate basket icon offset in x-axis -->
            var x_offset = -0.4 + order_count * 0.11;
            order_count++;
            
            <!-- Create new icon entity to add to basket -->
            var icon_entity = document.createElement('a-entity');
            icon_entity.setAttribute('position', x_offset + ' -0.06 0');
            icon_entity.setAttribute('rotation', '0 0 0');
            icon_entity.setAttribute('animation', 'property: rotation; to: 0 360 0; dur: 6000; easing: linear; loop: true;');
            
            switch (data.item_id) {
              case "1":
                icon_entity.setAttribute('gltf-model', '#model-burger');
                icon_entity.setAttribute('scale', '0.5 0.5 0.5');
                break;
              case "2":
                icon_entity.setAttribute('gltf-model', '#model-chips');
                icon_entity.setAttribute('scale', '0.6 0.6 0.6');
                break;
              case "3":
                icon_entity.setAttribute('gltf-model', '#model-drink');
                icon_entity.setAttribute('scale', '0.42 0.42 0.42');
                break;
            }
            
            <!-- Add new icon as a child of the basket entity -->
            document.querySelector('#basket').appendChild(icon_entity);
          });
        },
      });
    </script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <a-asset-item id="model-burger" src="https://cdn.glitch.global/326e3dc1-eeff-4f02-8913-b8b16b58dbfd/burger.gltf?v=1673470710342"></a-asset-item>
        <a-asset-item id="model-chips" src="https://cdn.glitch.global/326e3dc1-eeff-4f02-8913-b8b16b58dbfd/chips.gltf?v=1673470890597"></a-asset-item>
        <a-asset-item id="model-drink" src="https://cdn.glitch.global/326e3dc1-eeff-4f02-8913-b8b16b58dbfd/drink.gltf?v=1673471242511"></a-asset-item>
        
        <!-- Target sphere surrounding each menu item -->
        <a-mixin id="item-sphere" button geometry="primitive: sphere;" material="color: white; opacity: 0.0;" scale="0.15 0.15 0.15"></a-mixin>
        
        <!-- 3D model icon for menu items -->
        <a-mixin id="item-icon" scale="5 5 5"
                 animation__hover="property: rotation; to: 0 360 0; dur: 4000; easing: linear; loop: true; startEvents: rotation-begin; pauseEvents: rotation-pause; resumeEvents: rotation-resume;"
                 animation__click="property: scale; from: 3 3 3; to: 5 5 5; dur: 500; easing: linear; loop: false; startEvents: scale-begin;"></a-mixin>
        
        <!-- Text label for menu items -->
        <a-mixin id="item-label" geometry="primitive: plane;" material="opacity: 0.0;" scale="1.5 1.5 1.5" text="align: center; anchor: center; baseline: center; color: white; wrap-count: 10;"></a-mixin>
      </a-assets>

      <a-sky color="#518CC9"></a-sky>

      <!-- Create cursor with animated visual feedback -->
      <a-entity camera look-controls wasd-controls position="0 1.6 0">
        <a-entity cursor="fuse: true; fuseTimeout: 800" raycaster="objects: .selectable"
                  material="color: white; shader: flat; opacity: 0.8;" position="0 0 -0.1"
                  geometry="primitive: ring; radiusInner: 0.002; radiusOuter: 0.004"
                  animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 500; from: 0.2 0.2 0.2; to: 1 1 1"
                  animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 800; from: 1 1 1; to: 0.2 0.2 0.2"
                  animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 100; to: 1 1 1">
        </a-entity>
      </a-entity>

      <a-text value="Your Order" position="-0.49 1.14 -1.49" scale="0.2 0.2" align="left"></a-text>
      <a-text id="order-price" value="0.00" position="0.49 1.14 -1.49" scale="0.2 0.2" align="right"></a-text>
      <a-plane id="basket" color="black" opacity="0.2" width="1.0" height="0.2" position="0 1.0 -1.5"></a-plane>
      <a-text value="shake device to clear order" position="0 0.87 -1.49" scale="0.15 0.15" align="center"></a-text>
      
      <!-- Menu item: burger -->
      <a-sphere button="item_id: 1;" mixin="item-sphere" class="selectable" position="-0.22 1.58 -1" >
        <a-entity mixin="item-icon" class="icon" gltf-model="#model-burger" position="0 -0.2 0" scale="5 5 5"></a-entity>
        <a-entity mixin="item-label" class="item-label" text="value: Burger 3.50;" position="0 -0.5 0.1"></a-entity>
      </a-sphere>
      
      <!-- Menu item: chips -->
      <a-sphere button="item_id: 2;" mixin="item-sphere" class="selectable" position="0.22 1.58 -1">
        <a-entity mixin="item-icon" class="icon" gltf-model="#model-chips" position="0 -0.15 0" scale="5 5 5"></a-entity>
        <a-entity mixin="item-label" text="value: Chips 1.50;" position="0 -0.5 0.1"></a-entity>
      </a-sphere>
      
      <!-- Menu item: drink -->
      <a-sphere button="item_id: 3;" mixin="item-sphere"  class="selectable" position="0.0 1.82 -1" rotation="30 0 0">
        <a-entity mixin="item-icon" class="icon" gltf-model="#model-drink" position="0 -0.22 0"></a-entity>
        <a-entity mixin="item-label" text="value: Drink 1.00;" position="0 -0.5 0.1"></a-entity>
      </a-sphere>
    </a-scene>
  </body>
</html>
